{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the system, with roles such as Admin, Manager, or Employee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "role": {
          "type": "string",
          "description": "Role of the user (Admin, Manager, Employee)."
        },
        "googleId": {
          "type": "string",
          "description": "Google ID of the user, if they signed up using Google OAuth."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "role"
      ]
    },
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client of SK Traders.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the client entity."
        },
        "companyName": {
          "type": "string",
          "description": "Name of the client's company."
        },
        "contactName": {
          "type": "string",
          "description": "Contact person's name at the client's company."
        },
        "email": {
          "type": "string",
          "description": "Email address of the client.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the client."
        },
        "address": {
          "type": "string",
          "description": "Address of the client."
        },
        "exportPreferences": {
          "type": "string",
          "description": "Export preferences of the client (e.g., preferred port, shipping terms)."
        }
      },
      "required": [
        "id",
        "companyName",
        "contactName",
        "email",
        "phone"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product offered by SK Traders (Coco Pith, Coir Fiber, Coconut Husk Chips).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the product (e.g., Coco Pith, Coir Fiber, Coconut Husk Chips)."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement for the product (e.g., kg, ton)."
        }
      },
      "required": [
        "id",
        "name",
        "unit"
      ]
    },
    "Stock": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stock",
      "type": "object",
      "description": "Represents the stock level for a specific product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock entity."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Stock)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in stock."
        },
        "costPrice": {
          "type": "number",
          "description": "Cost price of the product."
        },
        "sellingPrice": {
          "type": "number",
          "description": "Selling price of the product."
        }
      },
      "required": [
        "id",
        "productId",
        "quantity",
        "costPrice",
        "sellingPrice"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N Sale)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Sale)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product sold."
        },
        "price": {
          "type": "number",
          "description": "Price per unit of the product sold."
        },
        "date": {
          "type": "string",
          "description": "Date of the sale.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "clientId",
        "productId",
        "quantity",
        "price",
        "date"
      ]
    },
    "Purchase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Purchase",
      "type": "object",
      "description": "Represents a purchase transaction of raw husk.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the purchase entity."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Purchase)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of raw husk purchased."
        },
        "price": {
          "type": "number",
          "description": "Price per unit of raw husk purchased."
        },
        "date": {
          "type": "string",
          "description": "Date of the purchase.",
          "format": "date-time"
        },
        "supplier": {
          "type": "string",
          "description": "Supplier who supplied the husk."
        }
      },
      "required": [
        "id",
        "productId",
        "quantity",
        "price",
        "date",
        "supplier"
      ]
    },
    "Receipt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Receipt",
      "type": "object",
      "description": "Represents a receipt for a sale or purchase transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the receipt entity."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to Sale. (Relationship: Sale 1:N Receipt)"
        },
        "purchaseId": {
          "type": "string",
          "description": "Reference to Purchase. (Relationship: Purchase 1:N Receipt).  Can be null if the receipt is for a sale."
        },
        "date": {
          "type": "string",
          "description": "Date of the receipt.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the transaction."
        },
        "tax": {
          "type": "number",
          "description": "Tax amount on the transaction."
        }
      },
      "required": [
        "id",
        "date",
        "totalAmount"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense incurred by SK Traders.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense entity."
        },
        "description": {
          "type": "string",
          "description": "Description of the expense."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "Date of the expense.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "description",
        "amount",
        "date"
      ]
    },
    "Export": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Export",
      "type": "object",
      "description": "Represents an export order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the export entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N Export)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Export)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product exported."
        },
        "price": {
          "type": "number",
          "description": "Price per unit of the product exported."
        },
        "date": {
          "type": "string",
          "description": "Date of the export.",
          "format": "date-time"
        },
        "companyName": {
          "type": "string",
          "description": "Name of the international buyer's company."
        },
        "country": {
          "type": "string",
          "description": "Country of destination for the export."
        },
        "port": {
          "type": "string",
          "description": "Port of destination for the export."
        },
        "contact": {
          "type": "string",
          "description": "Contact information for the international buyer."
        }
      },
      "required": [
        "id",
        "clientId",
        "productId",
        "quantity",
        "price",
        "date",
        "companyName",
        "country",
        "port",
        "contact"
      ]
    },
    "FinancialTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FinancialTransaction",
      "type": "object",
      "description": "Represents a financial transaction, encompassing both income (sales) and expenses. To be used by the faulty component.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the financial transaction."
        },
        "date": {
          "type": "string",
          "description": "Date of the transaction.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of transaction (Income or Expense)."
        },
        "description": {
          "type": "string",
          "description": "Description of the transaction."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "source": {
          "type": "string",
          "description": "Source of transaction (Sale or Purchase or General)."
        }
      },
      "required": [
        "id",
        "date",
        "type",
        "description",
        "amount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The `userId` parameter is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Stores client information.",
          "params": [
            {
              "name": "clientId",
              "description": "Unique identifier for the client."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/stock/{stockId}",
        "definition": {
          "entityName": "Stock",
          "schema": {
            "$ref": "#/backend/entities/Stock"
          },
          "description": "Stores stock level for each product.",
          "params": [
            {
              "name": "stockId",
              "description": "Unique identifier for the stock entry."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores sales transaction information.",
          "params": [
            {
              "name": "saleId",
              "description": "Unique identifier for the sale transaction."
            }
          ]
        }
      },
      {
        "path": "/purchases/{purchaseId}",
        "definition": {
          "entityName": "Purchase",
          "schema": {
            "$ref": "#/backend/entities/Purchase"
          },
          "description": "Stores purchase transaction information.",
          "params": [
            {
              "name": "purchaseId",
              "description": "Unique identifier for the purchase transaction."
            }
          ]
        }
      },
      {
        "path": "/receipts/{receiptId}",
        "definition": {
          "entityName": "Receipt",
          "schema": {
            "$ref": "#/backend/entities/Receipt"
          },
          "description": "Stores receipt information for sales and purchases.",
          "params": [
            {
              "name": "receiptId",
              "description": "Unique identifier for the receipt."
            }
          ]
        }
      },
      {
        "path": "/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense information.",
          "params": [
            {
              "name": "expenseId",
              "description": "Unique identifier for the expense."
            }
          ]
        }
      },
      {
        "path": "/exports/{exportId}",
        "definition": {
          "entityName": "Export",
          "schema": {
            "$ref": "#/backend/entities/Export"
          },
          "description": "Stores export order information.",
          "params": [
            {
              "name": "exportId",
              "description": "Unique identifier for the export order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/financial_transactions/{transactionId}",
        "definition": {
          "entityName": "FinancialTransaction",
          "schema": {
            "$ref": "#/backend/entities/FinancialTransaction"
          },
          "description": "Stores financial transaction data specific to each user. The `userId` parameter matches the user's Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "transactionId",
              "description": "Unique identifier for the financial transaction."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection denote admin role membership. Existence of a document with a `userId` implies the user is an admin.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/roles_manager/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection denote manager role membership. Existence of a document with a `userId` implies the user is a manager.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/roles_employee/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection denote employee role membership. Existence of a document with a `userId` implies the user is an employee.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage SK Traders' data efficiently and securely. It incorporates denormalization to ensure authorization independence, enabling robust security rules without relying on hierarchical `get()` calls. User roles are managed through a dedicated collection, eliminating the need for custom claims. The structure also addresses QAPs (Queries are not filters) by segregating data based on access control requirements.\n\nSpecifically, authorization independence is achieved by storing role information in separate collections like `/roles_admin/{userId}`, `/roles_manager/{userId}`, and `/roles_employee/{userId}`. Security rules can then directly verify the existence of a document in these collections based on `request.auth.uid`, avoiding `get()` calls to user documents. \n\nThe structure supports required QAPs by using path-based ownership for user-specific data (e.g., `/users/{userId}/sales/{saleId}`) and dedicated collections for global roles (e.g., `/roles_admin/{userId}`). This segregation enables secure `list` operations, as security rules can efficiently enforce access control based on path and role membership. The segregation allows different security postures for different collections, which increases security and simplifies the overall security rules creation process.\n\nFinancial transactions are segmented by user ID to ensure that each user can only access their own transaction data, which is crucial for maintaining privacy and data integrity."
  }
}