{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (Admin, Manager, Employee)."
        },
        "googleId": {
          "type": "string",
          "description": "Google ID of the user (for OAuth login)."
        }
      },
      "required": [
        "id",
        "email",
        "role"
      ]
    },
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client of SK Traders.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the client."
        },
        "name": {
          "type": "string",
          "description": "Name of the client."
        },
        "contactInfo": {
          "type": "string",
          "description": "Contact information of the client (e.g., phone number, address)."
        },
        "exportPreferences": {
          "type": "string",
          "description": "Export preferences of the client."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product (Coco Pith, Coir Fiber, Coconut Husk Chips).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Stock": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stock",
      "type": "object",
      "description": "Represents the stock level of a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock entry."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Stock)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in stock."
        },
        "costPrice": {
          "type": "number",
          "description": "Cost price of the product."
        },
        "sellingPrice": {
          "type": "number",
          "description": "Selling price of the product."
        }
      },
      "required": [
        "id",
        "productId",
        "quantity",
        "costPrice",
        "sellingPrice"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale transaction."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N Sale)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Sale)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product sold."
        },
        "saleDate": {
          "type": "string",
          "description": "Date of the sale.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of sales."
        }
      },
      "required": [
        "id",
        "clientId",
        "productId",
        "quantity",
        "saleDate"
      ]
    },
    "Purchase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Purchase",
      "type": "object",
      "description": "Represents a purchase transaction (raw husk).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the purchase transaction."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Purchase)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product purchased."
        },
        "purchaseDate": {
          "type": "string",
          "description": "Date of the purchase.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of purchase."
        }
      },
      "required": [
        "id",
        "productId",
        "quantity",
        "purchaseDate"
      ]
    },
    "Receipt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Receipt",
      "type": "object",
      "description": "Represents a receipt for a sale or purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the receipt."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to Sale. (Relationship: Sale 1:1 Receipt)"
        },
        "purchaseId": {
          "type": "string",
          "description": "Reference to Purchase. (Relationship: Purchase 1:1 Receipt)"
        },
        "receiptDate": {
          "type": "string",
          "description": "Date of the receipt.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total Amount on the receipt"
        },
        "tax": {
          "type": "number",
          "description": "Tax applied on the product"
        }
      },
      "required": [
        "id",
        "receiptDate"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense."
        },
        "description": {
          "type": "string",
          "description": "Description of the expense."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "expenseDate": {
          "type": "string",
          "description": "Date of the expense.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "description",
        "amount",
        "expenseDate"
      ]
    },
    "Export": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Export",
      "type": "object",
      "description": "Represents an export order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the export order."
        },
        "internationalBuyerDetails": {
          "type": "string",
          "description": "Details of the international buyer (company name, country, port, contact)."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Export)"
        },
        "exportDate": {
          "type": "string",
          "description": "Date of the export.",
          "format": "date-time"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product."
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of export."
        }
      },
      "required": [
        "id",
        "internationalBuyerDetails",
        "exportDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. Path-based ownership ensures only the user can access their own data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Stores client data. Accessible to admins and managers.",
          "params": [
            {
              "name": "clientId",
              "description": "The unique identifier of the client."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Accessible to admins.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/stock/{stockId}",
        "definition": {
          "entityName": "Stock",
          "schema": {
            "$ref": "#/backend/entities/Stock"
          },
          "description": "Stores stock levels for each product. Requires admin or manager role. Includes denormalized data if needed (e.g., product name).",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            },
            {
              "name": "stockId",
              "description": "The unique identifier of the stock entry."
            }
          ]
        }
      },
      {
        "path": "/clients/{clientId}/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores sales data associated with a client. Includes denormalized client and product names for authorization independence.",
          "params": [
            {
              "name": "clientId",
              "description": "The unique identifier of the client."
            },
            {
              "name": "saleId",
              "description": "The unique identifier of the sale."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/purchases/{purchaseId}",
        "definition": {
          "entityName": "Purchase",
          "schema": {
            "$ref": "#/backend/entities/Purchase"
          },
          "description": "Stores purchase data for each product. Includes denormalized product name for authorization independence.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            },
            {
              "name": "purchaseId",
              "description": "The unique identifier of the purchase."
            }
          ]
        }
      },
      {
        "path": "/receipts/{receiptId}",
        "definition": {
          "entityName": "Receipt",
          "schema": {
            "$ref": "#/backend/entities/Receipt"
          },
          "description": "Stores receipt data.",
          "params": [
            {
              "name": "receiptId",
              "description": "The unique identifier of the receipt."
            }
          ]
        }
      },
      {
        "path": "/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense data. Accessible to admins and managers.",
          "params": [
            {
              "name": "expenseId",
              "description": "The unique identifier of the expense."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/exports/{exportId}",
        "definition": {
          "entityName": "Export",
          "schema": {
            "$ref": "#/backend/entities/Export"
          },
          "description": "Stores export data. Includes denormalized product name for authorization independence.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            },
            {
              "name": "exportId",
              "description": "The unique identifier of the export."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store UIDs of admin users. Existence of a document grants admin role.",
          "params": [
            {
              "name": "uid",
              "description": "The unique identifier of the user with admin role."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization of authorization-related data, eliminating the need for `get()` calls in security rules. Structural Segregation is employed to maintain a homogeneous security posture within each collection. Access Modeling follows consistent patterns for private, user-owned, collaborative, and global roles.\n\n*   **Users:** User data is stored in the `/users/{userId}` collection, ensuring path-based ownership for private data. This approach provides simple and secure access control based on `request.auth.uid`.\n*   **Clients:** Client data is stored in the `/clients/{clientId}` collection. No specific ownership is defined here. Admin or manager roles can be configured to manage clients.\n*   **Products:** Product data is stored in the `/products/{productId}` collection. Admin roles can be configured to manage Products.\n*   **Stock:** Stock data is stored in the `/products/{productId}/stock/{stockId}` subcollection, establishing a clear ownership hierarchy. This design enables secure stock management based on product ownership.\n*   **Sales:** Sale data is stored in the `/clients/{clientId}/sales/{saleId}` subcollection to ensure access control tied to the client. Critical properties from Product (name) and Client (name) will be denormalized into the Sale document to ensure Authorization Independence.\n*   **Purchases:** Purchase data is stored in the `/products/{productId}/purchases/{purchaseId}` subcollection, creating a clear hierarchy. Properties from Product are denormalized into the Purchase document to guarantee Authorization Independence.\n*   **Receipts:** Receipts are stored in `/receipts/{receiptId}`. The `saleId` and `purchaseId` fields can be used to query the receipts. The choice of collection is justified by the 1:1 relationship with sales and purchases which allows atomic operations when creating the receipts.\n*   **Expenses:** Expenses are stored in the `/expenses/{expenseId}` collection. Expense-related data is segregated for distinct access control.\n*   **Exports:** Export data is stored in the `/products/{productId}/exports/{exportId}` subcollection, maintaining a hierarchical structure. Properties from the product document are denormalized to enable Authorization Independence.\n*   **Roles:** The `/roles_admin/{uid}` collection is used to assign admin roles. The existence of a document in this collection grants admin privileges. This approach simplifies global role management and enhances security.\n\nThis structure facilitates secure `list` operations (QAPs) through structural segregation, path-based ownership, and membership maps. It eliminates the need for complex filtering rules and ensures that only authorized data is accessed. Denormalization ensures that authorization checks can be performed without relying on `get()` calls, maintaining atomic operations and simplifying debugging."
  }
}