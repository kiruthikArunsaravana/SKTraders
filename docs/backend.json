{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the system, with different roles (Admin, Manager, Employee).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "User's role (Admin, Manager, or Employee)."
        },
        "googleId": {
          "type": "string",
          "description": "Google ID for OAuth login (optional)."
        }
      },
      "required": [
        "id",
        "email",
        "role"
      ]
    },
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client of SK Traders.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the client entity."
        },
        "companyName": {
          "type": "string",
          "description": "Client's company name."
        },
        "contactName": {
          "type": "string",
          "description": "Client's contact name."
        },
        "contactEmail": {
          "type": "string",
          "description": "Client's contact email.",
          "format": "email"
        },
        "country": {
          "type": "string",
          "description": "Country of the client."
        },
        "clientType": {
          "type": "string",
          "description": "Type of client, can be local or international.",
          "enum": [
            "local",
            "international"
          ]
        },
        "totalSales": {
          "type": "number",
          "description": "Total sales amount for the client."
        },
        "lastPurchaseDate": {
          "type": "string",
          "description": "Last purchase date by the client.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "companyName",
        "contactName",
        "contactEmail",
        "country",
        "clientType"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product (Coco Pith, Coir Fiber, Coconut Husk Chips).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product entity."
        },
        "name": {
          "type": "string",
          "description": "Product name (e.g., Coco Pith)."
        },
        "description": {
          "type": "string",
          "description": "Product description."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Stock": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stock",
      "type": "object",
      "description": "Represents the stock level for a specific product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock entity."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Stock)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in stock."
        },
        "costPrice": {
          "type": "number",
          "description": "Cost price of the product."
        },
        "sellingPrice": {
          "type": "number",
          "description": "Selling price of the product."
        }
      },
      "required": [
        "id",
        "productId",
        "quantity",
        "costPrice",
        "sellingPrice"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N Sale)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Sale)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product sold."
        },
        "price": {
          "type": "number",
          "description": "Price at which the product was sold."
        },
        "date": {
          "type": "string",
          "description": "Date of the sale.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "clientId",
        "productId",
        "quantity",
        "price",
        "date"
      ]
    },
    "Purchase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Purchase",
      "type": "object",
      "description": "Represents a purchase transaction (raw husk).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the purchase entity."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Purchase)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of raw husk purchased."
        },
        "price": {
          "type": "number",
          "description": "Price at which the raw husk was purchased."
        },
        "date": {
          "type": "string",
          "description": "Date of the purchase.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "quantity",
        "price",
        "date"
      ]
    },
    "Receipt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Receipt",
      "type": "object",
      "description": "Represents a receipt for a sale or purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the receipt entity."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to Sale (if it's a sales receipt). (Relationship: Sale 1:N Receipt)"
        },
        "purchaseId": {
          "type": "string",
          "description": "Reference to Purchase (if it's a purchase receipt). (Relationship: Purchase 1:N Receipt)"
        },
        "date": {
          "type": "string",
          "description": "Date of the receipt.",
          "format": "date-time"
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product."
        },
        "quantity": {
          "type": "number",
          "description": "Product Quantity."
        },
        "price": {
          "type": "number",
          "description": "Product Price."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the receipt."
        },
        "tax": {
          "type": "number",
          "description": "Tax included in amount."
        }
      },
      "required": [
        "id",
        "date"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense entity."
        },
        "description": {
          "type": "string",
          "description": "Description of the expense."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "Date of the expense.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "description",
        "amount",
        "date"
      ]
    },
    "Export": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Export",
      "type": "object",
      "description": "Represents an export order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the export entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N Export)"
        },
        "clientName": {
          "type": "string",
          "description": "Denormalized client's company name for easy display."
        },
        "companyName": {
          "type": "string",
          "description": "International buyer's company name."
        },
        "country": {
          "type": "string",
          "description": "Country of destination."
        },
        "port": {
          "type": "string",
          "description": "Port of destination."
        },
        "contact": {
          "type": "string",
          "description": "Contact information for the international buyer."
        },
        "date": {
          "type": "string",
          "description": "Date of the export.",
          "format": "date-time"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product."
        },
        "quantity": {
          "type": "number",
          "description": "Product Quantity."
        },
        "price": {
          "type": "number",
          "description": "Product price."
        },
        "paymentStatus": {
            "type": "string",
            "description": "The payment status of the order.",
            "enum": ["Pending", "Paid"]
        }
      },
      "required": [
        "id",
        "clientId",
        "clientName",
        "companyName",
        "country",
        "port",
        "contact",
        "date"
      ]
    },
    "LocalSale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LocalSale",
      "type": "object",
      "description": "Represents a local sale order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the local sale entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client. (Relationship: Client 1:N LocalSale)"
        },
        "clientName": {
          "type": "string",
          "description": "Denormalized client's company name for easy display."
        },
        "date": {
          "type": "string",
          "description": "Date of the sale.",
          "format": "date-time"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product."
        },
        "quantity": {
          "type": "number",
          "description": "Product Quantity."
        },
        "price": {
            "type": "number",
            "description": "Price per unit for the sale."
        },
        "invoiceNumber": {
          "type": "string",
          "description": "Invoice number for the sale."
        },
        "status": {
          "type": "string",
          "description": "The status of the sale."
        },
        "paymentStatus": {
            "type": "string",
            "description": "The payment status of the sale.",
            "enum": ["Pending", "Paid"]
        }
      },
      "required": [
        "id",
        "clientId",
        "clientName",
        "date",
        "productId",
        "quantity",
        "price",
        "invoiceNumber",
        "status",
        "paymentStatus"
      ]
    },
     "FinancialTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FinancialTransaction",
      "type": "object",
      "description": "Represents either an income or an expense transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "type": {
          "type": "string",
          "description": "The type of transaction, either 'income' or 'expense'.",
          "enum": ["income", "expense"]
        },
        "amount": {
          "type": "number",
          "description": "The monetary value of the transaction. Positive for income, negative for expense."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the transaction."
        },
        "date": {
          "type": "string",
          "description": "The date and time the transaction occurred.",
          "format": "date-time"
        },
        "category": {
          "type": "string",
          "description": "The category of the income (e.g., product name) or expense (e.g., 'Labour')."
        }
      },
      "required": ["id", "type", "amount", "description", "date", "category"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Includes denormalized 'role' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Stores client information.",
          "params": [
            {
              "name": "clientId",
              "description": "The unique identifier for the client."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information (Coco Pith, Coir Fiber, Coconut Husk Chips).",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/stocks/{stockId}",
        "definition": {
          "entityName": "Stock",
          "schema": {
            "$ref": "#/backend/entities/Stock"
          },
          "description": "Stores stock level for each product.",
          "params": [
            {
              "name": "stockId",
              "description": "The unique identifier for the stock."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores sale transactions.",
          "params": [
            {
              "name": "saleId",
              "description": "The unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/purchases/{purchaseId}",
        "definition": {
          "entityName": "Purchase",
          "schema": {
            "$ref": "#/backend/entities/Purchase"
          },
          "description": "Stores purchase transactions (raw husk).",
          "params": [
            {
              "name": "purchaseId",
              "description": "The unique identifier for the purchase."
            }
          ]
        }
      },
      {
        "path": "/receipts/{receiptId}",
        "definition": {
          "entityName": "Receipt",
          "schema": {
            "$ref": "#/backend/entities/Receipt"
          },
          "description": "Stores receipts for sales and purchases.",
          "params": [
            {
              "name": "receiptId",
              "description": "The unique identifier for the receipt."
            }
          ]
        }
      },
      {
        "path": "/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense records.",
          "params": [
            {
              "name": "expenseId",
              "description": "The unique identifier for the expense."
            }
          ]
        }
      },
      {
        "path": "/exports/{exportId}",
        "definition": {
          "entityName": "Export",
          "schema": {
            "$ref": "#/backend/entities/Export"
          },
          "description": "Stores export order details.",
          "params": [
            {
              "name": "exportId",
              "description": "The unique identifier for the export."
            }
          ]
        }
      },
      {
        "path": "/local_sales/{localSaleId}",
        "definition": {
          "entityName": "LocalSale",
          "schema": {
            "$ref": "#/backend/entities/LocalSale"
          },
          "description": "Stores local sale order details.",
          "params": [
            {
              "name": "localSaleId",
              "description": "The unique identifier for the local sale."
            }
          ]
        }
      },
      {
        "path": "/financial_transactions/{transactionId}",
        "definition": {
          "entityName": "FinancialTransaction",
          "schema": { "$ref": "#/backend/entities/FinancialTransaction" },
          "description": "Stores all income and expense transactions.",
          "params": [
            {
              "name": "transactionId",
              "description": "The unique identifier for the financial transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to reflect the core entities of the HuskTrack system and enforce robust security rules. Key design decisions prioritize authorization independence through denormalization and structural segregation for simplified rules and scalable security.  \n\n1.  **Authorization Independence (Denormalization):**\n    *   User roles are stored directly in the `/users/{userId}` document. This avoids the need for `get()` calls to determine a user's role during other operations. All other entities that require role based access depend on the uid which is provided by `request.auth.uid` and its comparison with roles present in each entity.\n\n2.  **Structural Segregation:**\n    *   The structure segregates data based on ownership and access requirements. User-specific data resides under `/users/{userId}`, while global data like `/products` is stored at the root level.\n    *   This segregation simplifies security rules by ensuring that all documents within a collection share the same security posture. For example, only admins can modify product data, while users can only modify their own user documents.\n\n3.  **Access Modeling:**\n    *   **User-Owned Data:** The `/users/{userId}` collection follows the Path-Based Ownership model, granting users full control over their own data.\n    *   **Global Data:** The `/products`, `/clients` collections are accessible to users with appropriate roles (e.g., Admin for products, Manager/Admin for clients).\n\n4. **QAPs (Rules are not Filters):**\n    * Role based access to product, sale, purchase, receipt, expense and export data enables secure `list` operations, as read operations are constrained to authorized users via `request.auth.uid` and its comparison with roles present in each entity."
  }
}
