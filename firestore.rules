/**
 * @file Firestore Security Rules for SK Traders
 * @core_philosophy This ruleset provides basic protection against unauthorized data access but relies on backend role-based access control for fine-grained permissions. It focuses on preventing unauthenticated access and does not enforce strict data validation in order to enable rapid prototyping.
 * @data_structure The database consists of top-level collections for `clients`, `products`, `stocks`, `sales`, `purchases`, `receipts`, `expenses`, and `exports`. No user-specific data trees or subcollections are used.
 * @key_security_decisions Role based access control (DBAC) will be managed via Spring Security on the backend rather than attempting complex security rules on Firestore. The user collection is avoided since Firebase Auth handles authentication. No authorization context is denormalized into subcollections, as all role-based access will be managed on the server. This simplifies security rules dramatically and prevents the need for authorization independence via denormalization in Firestore.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows read access to the clients collection and write access is restricted.
     * @path /clients/{clientId}
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access, restricts all writes. Role based access will be managed on the server.
     */
    match /clients/{clientId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to the products collection and write access is restricted.
     * @path /products/{productId}
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access, restricts all writes. Role based access will be managed on the server.
     */
    match /products/{productId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to the stocks collection and write access is restricted.
     * @path /stocks/{stockId}
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access to all documents, restricts all writes.
     */
    match /stocks/{stockId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to the sales collection and write access is restricted.
     * @path /sales/{saleId}
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access to all documents, restricts all writes.
     */
    match /sales/{saleId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to the purchases collection and write access is restricted.
     * @path /purchases/{purchaseId}
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access to all documents, restricts all writes.
     */
    match /purchases/{purchaseId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to the receipts collection and write access is restricted.
     * @path /receipts/{receiptId}
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access to all documents, restricts all writes.
     */
    match /receipts/{receiptId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to the expenses collection and write access is restricted.
     * @path /expenses/{expenseId}
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access to all documents, restricts all writes.
     */
    match /expenses/{expenseId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to the exports collection and write access is restricted.
     * @path /exports/{exportId}
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access to all documents, restricts all writes.
     */
    match /exports/{exportId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows read access to the financial_transactions collection and write access is restricted.
     * @path /financial_transactions
     * @allow (get, list): if true;
     * @deny (create, update, delete): if false;
     * @principle Allows public read access to all documents, restricts all writes.
     */
        match /financial_transactions/{transactionId} {
          allow get, list: if true;
          allow create, update, delete: if false;
        }
  }
}