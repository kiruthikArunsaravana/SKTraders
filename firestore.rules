/**
 * @fileoverview Firestore Security Rules for SK Traders.
 *
 * Core Philosophy:
 * This ruleset provides baseline security for the SK Traders application, allowing all signed-in users full access to all data.
 * Role-based access control is intended to be managed on the backend via Spring Security, simplifying these rules.
 *
 * Data Structure:
 * The Firestore database consists of top-level collections for core entities: 'clients', 'products', 'stocks', 'sales', 'purchases', 'receipts', 'expenses', and 'exports'.
 * There is no user-specific data segregation within the database itself.
 *
 * Key Security Decisions:
 * - Role-based access control is handled on the backend, not in the rules.
 * - No user-specific ownership checks or data segregation is enforced within Firestore.
 * - All authenticated users are granted full read and write access to all collections.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any authenticated user to read and write client data.
     * @path /clients/{clientId}
     * @allow (get, list, create, update, delete) - Any signed-in user.
     * @deny None.
     * @principle Grants full access to authenticated users for prototyping and defers role-based access control to the backend.
     */
    match /clients/{clientId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write product data.
     * @path /products/{productId}
     * @allow (get, list, create, update, delete) - Any signed-in user.
     * @deny None.
     * @principle Grants full access to authenticated users for prototyping and defers role-based access control to the backend.
     */
    match /products/{productId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write stock data.
     * @path /stocks/{stockId}
     * @allow (get, list, create, update, delete) - Any signed-in user.
     * @deny None.
     * @principle Grants full access to authenticated users for prototyping and defers role-based access control to the backend.
     */
    match /stocks/{stockId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write sale data.
     * @path /sales/{saleId}
     * @allow (get, list, create, update, delete) - Any signed-in user.
     * @deny None.
     * @principle Grants full access to authenticated users for prototyping and defers role-based access control to the backend.
     */
    match /sales/{saleId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write purchase data.
     * @path /purchases/{purchaseId}
     * @allow (get, list, create, update, delete) - Any signed-in user.
     * @deny None.
     * @principle Grants full access to authenticated users for prototyping and defers role-based access control to the backend.
     */
    match /purchases/{purchaseId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write receipt data.
     * @path /receipts/{receiptId}
     * @allow (get, list, create, update, delete) - Any signed-in user.
     * @deny None.
     * @principle Grants full access to authenticated users for prototyping and defers role-based access control to the backend.
     */
    match /receipts/{receiptId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write expense data.
     * @path /expenses/{expenseId}
     * @allow (get, list, create, update, delete) - Any signed-in user.
     * @deny None.
     * @principle Grants full access to authenticated users for prototyping and defers role-based access control to the backend.
     */
    match /expenses/{expenseId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write export data.
     * @path /exports/{exportId}
     * @allow (get, list, create, update, delete) - Any signed-in user.
     * @deny None.
     * @principle Grants full access to authenticated users for prototyping and defers role-based access control to the backend.
     */
    match /exports/{exportId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    function isSignedIn() {
        return request.auth != null;
    }
  }
}