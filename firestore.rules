/**
 * @fileoverview Firestore Security Rules for SK Traders.
 *
 * Core Philosophy:
 * This ruleset prioritizes simplicity and relies on backend role-based access control (RBAC) implemented via Spring Security.
 * It assumes that all users (Admin, Manager, Employee) will need to access most collections,
 * and authorization decisions are made on the server side. Therefore, the rules primarily focus on requiring authentication.
 *
 * Data Structure:
 * The data is organized into top-level collections: /clients/{clientId}, /products/{productId}, /stocks/{stockId},
 * /sales/{saleId}, /purchases/{purchaseId}, /receipts/{receiptId}, /expenses/{expenseId}, and /exports/{exportId}.
 *
 * Key Security Decisions:
 * - Role-based access control (DBAC) is handled on the backend, not within Firestore Security Rules.
 * - Data validation is not enforced within Firestore Security Rules.
 * - All authenticated users can read and write to all collections.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to the /clients/{clientId} collection.
     * @path /clients/{clientId}
     * @allow (get, list) Authenticated user can read client data.
     * @allow (create, update, delete) Authenticated user can write client data.
     * @deny Unauthenticated user cannot access client data.
     * @principle Allows access to authenticated users and denies access to unauthenticated users.
     */
    match /clients/{clientId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to the /products/{productId} collection.
     * @path /products/{productId}
     * @allow (get, list) Authenticated user can read product data.
     * @allow (create, update, delete) Authenticated user can write product data.
     * @deny Unauthenticated user cannot access product data.
     * @principle Allows access to authenticated users and denies access to unauthenticated users.
     */
    match /products/{productId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to the /stocks/{stockId} collection.
     * @path /stocks/{stockId}
     * @allow (get, list) Authenticated user can read stock data.
     * @allow (create, update, delete) Authenticated user can write stock data.
     * @deny Unauthenticated user cannot access stock data.
     * @principle Allows access to authenticated users and denies access to unauthenticated users.
     */
    match /stocks/{stockId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to the /sales/{saleId} collection.
     * @path /sales/{saleId}
     * @allow (get, list) Authenticated user can read sale data.
     * @allow (create, update, delete) Authenticated user can write sale data.
     * @deny Unauthenticated user cannot access sale data.
     * @principle Allows access to authenticated users and denies access to unauthenticated users.
     */
    match /sales/{saleId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to the /purchases/{purchaseId} collection.
     * @path /purchases/{purchaseId}
     * @allow (get, list) Authenticated user can read purchase data.
     * @allow (create, update, delete) Authenticated user can write purchase data.
     * @deny Unauthenticated user cannot access purchase data.
     * @principle Allows access to authenticated users and denies access to unauthenticated users.
     */
    match /purchases/{purchaseId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to the /receipts/{receiptId} collection.
     * @path /receipts/{receiptId}
     * @allow (get, list) Authenticated user can read receipt data.
     * @allow (create, update, delete) Authenticated user can write receipt data.
     * @deny Unauthenticated user cannot access receipt data.
     * @principle Allows access to authenticated users and denies access to unauthenticated users.
     */
    match /receipts/{receiptId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to the /expenses/{expenseId} collection.
     * @path /expenses/{expenseId}
     * @allow (get, list) Authenticated user can read expense data.
     * @allow (create, update, delete) Authenticated user can write expense data.
     * @deny Unauthenticated user cannot access expense data.
     * @principle Allows access to authenticated users and denies access to unauthenticated users.
     */
    match /expenses/{expenseId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to the /exports/{exportId} collection.
     * @path /exports/{exportId}
     * @allow (get, list) Authenticated user can read export data.
     * @allow (create, update, delete) Authenticated user can write export data.
     * @deny Unauthenticated user cannot access export data.
     * @principle Allows access to authenticated users and denies access to unauthenticated users.
     */
    match /exports/{exportId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}