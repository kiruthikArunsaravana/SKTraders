/**
 * @fileoverview Firestore Security Rules for HuskTrack System
 *
 * Core Philosophy:
 * This ruleset provides open access to all collections.
 *
 * Data Structure:
 * - /users/{userId}: Stores user profiles.
 * - /clients/{clientId}: Stores client information.
 * - /products/{productId}: Stores product information.
 * - /stocks/{stockId}: Stores stock level for each product.
 * - /sales/{saleId}: Stores sale transactions.
 * - /purchases/{purchaseId}: Stores purchase transactions (raw husk).
 * - /receipts/{receiptId}: Stores receipts for sales and purchases.
 * - /expenses/{expenseId}: Stores expense records.
 * - /exports/{exportId}: Stores export order details.
 * - /local_sales/{localSaleId}: Stores local sale order details.
 * - /financial_transactions/{transactionId}: Stores financial transactions.
 *
 * Key Security Decisions:
 * - No specific restrictions on reads or writes.
 *
 * Denormalization for Authorization:
 * - None.
 *
 * Structural Segregation:
 * - None.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Manages user profiles.
     * @path /users/{userId}
     * @allow (create) User with matching ID can create their profile.
     * @deny (update) User cannot update another user's profile.
     * @principle Enforces document ownership for writes.
     */
    match /users/{userId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages client information.
     * @path /clients/{clientId}
     * @allow (create) Any authenticated user can create a client.
     * @deny (delete) Only specific roles can delete clients.
     * @principle Controls access to client data.
     */
    match /clients/{clientId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages product information.
     * @path /products/{productId}
     * @allow (get) Any user can read product information.
     * @deny (create) Only specific roles can create products.
     * @principle Controls access to product data.
     */
    match /products/{productId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages stock level for each product.
     * @path /stocks/{stockId}
     * @allow (get) Any user can read stock information.
     * @deny (update) Only specific roles can update stock levels.
     * @principle Controls access to stock data.
     */
    match /stocks/{stockId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages sale transactions.
     * @path /sales/{saleId}
     * @allow (create) Any authenticated user can create a sale.
     * @deny (delete) Only specific roles can delete sales.
     * @principle Controls access to sale data.
     */
    match /sales/{saleId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages purchase transactions (raw husk).
     * @path /purchases/{purchaseId}
     * @allow (create) Any authenticated user can create a purchase.
     * @deny (delete) Only specific roles can delete purchases.
     * @principle Controls access to purchase data.
     */
    match /purchases/{purchaseId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages receipts for sales and purchases.
     * @path /receipts/{receiptId}
     * @allow (create) Any authenticated user can create a receipt.
     * @deny (delete) Only specific roles can delete receipts.
     * @principle Controls access to receipt data.
     */
    match /receipts/{receiptId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages expense records.
     * @path /expenses/{expenseId}
     * @allow (create) Any authenticated user can create an expense.
     * @deny (delete) Only specific roles can delete expenses.
     * @principle Controls access to expense data.
     */
    match /expenses/{expenseId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages export order details.
     * @path /exports/{exportId}
     * @allow (create) Any authenticated user can create an export.
     * @deny (delete) Only specific roles can delete exports.
     * @principle Controls access to export data.
     */
    match /exports/{exportId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages local sale order details.
     * @path /local_sales/{localSaleId}
     * @allow (create) Any authenticated user can create a local sale.
     * @deny (delete) Only specific roles can delete local sales.
     * @principle Controls access to local sale data.
     */
    match /local_sales/{localSaleId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description Manages financial transactions (income or expense).
     * @path /financial_transactions/{transactionId}
     * @allow (create) Any authenticated user can create a transaction.
     * @deny (delete) Only specific roles can delete transactions.
     * @principle Controls access to financial transaction data.
     */
    match /financial_transactions/{transactionId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }
  }
}