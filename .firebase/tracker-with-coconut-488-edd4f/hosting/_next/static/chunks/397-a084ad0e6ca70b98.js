"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[397],{12397:(e,t,a)=>{a.d(t,{A:()=>k});var r=a(95155),i=a(12115),n=a(62177),o=a(90221),s=a(55594),l=a(83013),d=a(52873),c=a(51920),u=a(50172),m=a(68718),f=a(59434),p=a(30285),g=a(85511),y=a(66695),h=a(66634),x=a(85057);let b=n.Op,v=i.createContext({}),S=e=>{let{...t}=e;return(0,r.jsx)(v.Provider,{value:{name:t.name},children:(0,r.jsx)(n.xI,{...t})})},P=()=>{let e=i.useContext(v),t=i.useContext(j),{getFieldState:a,formState:r}=(0,n.xW)(),o=a(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:s}=t;return{id:s,name:e.name,formItemId:"".concat(s,"-form-item"),formDescriptionId:"".concat(s,"-form-item-description"),formMessageId:"".concat(s,"-form-item-message"),...o}},j=i.createContext({}),w=i.forwardRef((e,t)=>{let{className:a,...n}=e,o=i.useId();return(0,r.jsx)(j.Provider,{value:{id:o},children:(0,r.jsx)("div",{ref:t,className:(0,f.cn)("space-y-2",a),...n})})});w.displayName="FormItem";let D=i.forwardRef((e,t)=>{let{className:a,...i}=e,{error:n,formItemId:o}=P();return(0,r.jsx)(x.J,{ref:t,className:(0,f.cn)(n&&"text-destructive",a),htmlFor:o,...i})});D.displayName="FormLabel";let F=i.forwardRef((e,t)=>{let{...a}=e,{error:i,formItemId:n,formDescriptionId:o,formMessageId:s}=P();return(0,r.jsx)(h.DX,{ref:t,id:n,"aria-describedby":i?"".concat(o," ").concat(s):"".concat(o),"aria-invalid":!!i,...a})});F.displayName="FormControl";let T=i.forwardRef((e,t)=>{let{className:a,...i}=e,{formDescriptionId:n}=P();return(0,r.jsx)("p",{ref:t,id:n,className:(0,f.cn)("text-sm text-muted-foreground",a),...i})});T.displayName="FormDescription";let N=i.forwardRef((e,t)=>{var a;let{className:i,children:n,...o}=e,{error:s,formMessageId:l}=P(),d=s?String(null!=(a=null==s?void 0:s.message)?a:""):n;return d?(0,r.jsx)("p",{ref:t,id:l,className:(0,f.cn)("text-sm font-medium text-destructive",i),...o,children:d}):null});N.displayName="FormMessage";var A=a(14636),_=a(62523),R=a(26597),L=a(86087),C=a.n(L),M=a(87481),I=a(4635),O=a(35317),E=a(93473);let z=s.z.object({reportTitle:s.z.string().min(5,{message:"Title must be at least 5 characters."}),dateRange:s.z.object({from:s.z.date({required_error:"A start date is required."}),to:s.z.date().optional()})});function k(){let{toast:e}=(0,M.dj)(),[t,a]=(0,i.useState)(!1),s=(0,I.jt)(),h=(0,n.mN)({resolver:(0,o.u)(z),defaultValues:{reportTitle:"Monthly Financial Summary"}}),x=(0,I.$e)(()=>s?(0,O.P)((0,O.rJ)(s,"financial_transactions"),(0,O.My)("date","desc")):null,[s]),v=(0,I.$e)(()=>s?(0,O.P)((0,O.rJ)(s,"exports"),(0,O.My)("date","desc")):null,[s]),P=(0,I.$e)(()=>s?(0,O.P)((0,O.rJ)(s,"local_sales"),(0,O.My)("date","desc")):null,[s]),{data:j,isLoading:L}=(0,I.Ge)(x),{data:k,isLoading:G}=(0,I.Ge)(v),{data:q,isLoading:$}=(0,I.Ge)(P),Y=async t=>{a(!0);let{title:r,dateRange:i,transactions:n,exports:o,localSales:s}=t;if(0===n.length&&0===o.length&&0===s.length){e({variant:"destructive",title:"No Data Found",description:"There is no data in the selected date range to generate a report."}),a(!1);return}let d=new R.default,c=new Map(E.F.map(e=>[e.id,e])),u=o.filter(e=>"Paid"===e.paymentStatus),m=s.filter(e=>"Paid"===e.paymentStatus),f=o.filter(e=>"Pending"===e.paymentStatus),p=s.filter(e=>"Pending"===e.paymentStatus),g=u.reduce((e,t)=>e+t.quantity*t.price,0)+m.reduce((e,t)=>e+t.quantity*t.price,0)+n.filter(e=>"income"===e.type).reduce((e,t)=>e+t.amount,0),y=n.filter(e=>"expense"===e.type).reduce((e,t)=>e+Math.abs(t.amount),0),h=g-y,x=o.reduce((e,t)=>e+t.quantity*t.price,0),b=s.reduce((e,t)=>e+t.quantity*t.price,0),v=n.filter(e=>"expense"===e.type&&"Husk"===e.category).reduce((e,t)=>e+Math.abs(t.amount),0),S={};[...s,...o].forEach(e=>{var t;let a=(null==(t=c.get(e.productId))?void 0:t.name)||"Unknown Product";S[a]=(S[a]||0)+e.quantity}),d.setFont("Playfair Display","bold"),d.setFontSize(22),d.text(r,14,22),d.setFont("PT Sans","normal"),d.setFontSize(11),d.text("For SK Traders",14,30),d.text("Date Range: ".concat((0,l.GP)(i.from,"PPP")," - ").concat((0,l.GP)(i.to,"PPP")),14,42),d.text("Generated on: ".concat((0,l.GP)(new Date,"PPP")),14,36);let P=50;d.setFontSize(16),d.setFont("Playfair Display","bold"),d.text("Overall Summary",14,P),P+=8;let j=[["Total Income (Paid Sales + Other)","$".concat(g.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))],["Total Expenses","$".concat(y.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))],["Net Profit / Loss","$".concat(h.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))],["Total Export Value (All Statuses)","$".concat(x.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))],["Total Local Sales Value (All Statuses)","$".concat(b.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))],["Total Raw Husk Purchased Amount","$".concat(v.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))]];if(C()(d,{startY:P,head:[["Summary Metric","Amount"]],body:j,theme:"grid",headStyles:{fillColor:[40,50,80]}}),P=d.lastAutoTable.finalY+10,Object.keys(S).length>0){d.setFontSize(16),d.setFont("Playfair Display","bold"),d.text("Products Sold Summary",14,P),P+=8;let e=Object.entries(S).map(e=>{let[t,a]=e;return[t,a.toLocaleString()]});C()(d,{startY:P,head:[["Product Name","Total Quantity Sold"]],body:e,theme:"grid",headStyles:{fillColor:[40,50,80]}}),P=d.lastAutoTable.finalY+10}let w=[...f.map(e=>({client:e.clientName,amount:e.quantity*e.price,type:"Export"})),...p.map(e=>({client:e.clientName,amount:e.quantity*e.price,type:"Local"}))];if(w.length>0){d.setFontSize(16),d.setFont("Playfair Display","bold"),d.text("Pending Payments (Accounts Receivable)",14,P),P+=8;let e=w.map(e=>[e.client,e.type,"$".concat(e.amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))]);C()(d,{startY:P,head:[["Client Name","Sale Type","Amount Due"]],body:e,theme:"grid",headStyles:{fillColor:[200,100,100]}}),P=d.lastAutoTable.finalY+10}if(n.length>0){d.setFontSize(16),d.setFont("Playfair Display","bold"),d.text("Detailed Other Transactions",14,P),P+=8;let e=n.map(e=>[(0,l.GP)(e.date instanceof O.Dc?e.date.toDate():e.date,"yyyy-MM-dd"),e.description,e.category,e.type.charAt(0).toUpperCase()+e.type.slice(1),"$".concat(e.amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))]);C()(d,{startY:P,head:[["Date","Description","Category/Product","Type","Amount"]],body:e,theme:"grid",headStyles:{fillColor:[40,50,80]}}),P=d.lastAutoTable.finalY||P}d.setFontSize(10),d.text("--- End of Report ---",14,P+10),d.save("".concat(r.replace(/ /g,"_"),"-").concat((0,l.GP)(new Date,"yyyy-MM-dd"),".pdf")),e({title:"PDF Report Generated",description:"Your report has been successfully downloaded."}),a(!1)};async function V(t){a(!0);let r=!j||!k||!q;if(L||G||$||r){e({variant:"destructive",title:"Data not loaded",description:"Data is still loading, please try again in a moment."}),a(!1);return}let i=e=>{if(!(null==e?void 0:e.date))return!1;let a=e.date.toDate(),r=t.dateRange.from,i=new Date(t.dateRange.to?t.dateRange.to:r);return i.setHours(23,59,59,999),(0,d.v)(a,{start:r,end:i})},n=j.filter(i),o=k.filter(i),s=q.filter(i),l={from:t.dateRange.from,to:t.dateRange.to||t.dateRange.from};await Y({title:t.reportTitle,dateRange:l,transactions:n,exports:o,localSales:s}),a(!1)}let U=L||G||$;return(0,r.jsx)(b,{...h,children:(0,r.jsx)("form",{onSubmit:h.handleSubmit(V),className:"space-y-6",children:(0,r.jsxs)(y.Zp,{children:[(0,r.jsxs)(y.aR,{children:[(0,r.jsx)(y.ZB,{children:"Generate Comprehensive Report"}),(0,r.jsx)(y.BT,{children:"Select a date range to generate a PDF report with a full business summary."})]}),(0,r.jsxs)(y.Wu,{className:"space-y-6",children:[(0,r.jsx)(S,{control:h.control,name:"dateRange",render:e=>{var t,a,i,n;let{field:o}=e;return(0,r.jsxs)(w,{className:"flex flex-col",children:[(0,r.jsx)(D,{children:"Date range"}),(0,r.jsxs)(A.AM,{children:[(0,r.jsx)(A.Wv,{asChild:!0,children:(0,r.jsx)(F,{children:(0,r.jsxs)(p.$,{variant:"outline",className:(0,f.cn)("w-full justify-start text-left font-normal md:w-1/2",!(null==(t=o.value)?void 0:t.from)&&"text-muted-foreground"),children:[(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4"}),(null==(a=o.value)?void 0:a.from)?o.value.to?(0,r.jsxs)(r.Fragment,{children:[(0,l.GP)(o.value.from,"LLL dd, y")," -"," ",(0,l.GP)(o.value.to,"LLL dd, y")]}):(0,l.GP)(o.value.from,"LLL dd, y"):(0,r.jsx)("span",{children:"Pick a date range"})]})})}),(0,r.jsx)(A.hl,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(g.V,{mode:"range",selected:{from:null==(i=o.value)?void 0:i.from,to:null==(n=o.value)?void 0:n.to},onSelect:o.onChange,numberOfMonths:2,disabled:e=>e>new Date||e<new Date("2000-01-01")})})]}),(0,r.jsx)(N,{})]})}}),(0,r.jsx)(S,{control:h.control,name:"reportTitle",render:e=>{let{field:t}=e;return(0,r.jsxs)(w,{children:[(0,r.jsx)(D,{children:"Report Title"}),(0,r.jsx)(F,{children:(0,r.jsx)(_.p,{placeholder:"e.g., Q4 Financial Summary",...t})}),(0,r.jsx)(T,{children:"This will be the title of the generated PDF document."}),(0,r.jsx)(N,{})]})}})]}),(0,r.jsx)(y.wL,{className:"gap-2",children:(0,r.jsxs)(p.$,{type:"submit",disabled:t||U,children:[t||U?(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Generate PDF Report"]})})]})})})}},14636:(e,t,a)=>{a.d(t,{AM:()=>s,Wv:()=>l,hl:()=>d});var r=a(95155),i=a(12115),n=a(98176),o=a(59434);let s=n.bL,l=n.l9,d=i.forwardRef((e,t)=>{let{className:a,align:i="center",sideOffset:s=4,...l}=e;return(0,r.jsx)(n.ZL,{children:(0,r.jsx)(n.UC,{ref:t,align:i,sideOffset:s,className:(0,o.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});d.displayName=n.UC.displayName},30285:(e,t,a)=>{a.d(t,{$:()=>d,r:()=>l});var r=a(95155),i=a(12115),n=a(66634),o=a(74466),s=a(59434);let l=(0,o.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((e,t)=>{let{className:a,variant:i,size:o,asChild:d=!1,...c}=e,u=d?n.DX:"button";return(0,r.jsx)(u,{className:(0,s.cn)(l({variant:i,size:o,className:a})),ref:t,...c})});d.displayName="Button"},62523:(e,t,a)=>{a.d(t,{p:()=>o});var r=a(95155),i=a(12115),n=a(59434);let o=i.forwardRef((e,t)=>{let{className:a,type:i,...o}=e;return(0,r.jsx)("input",{type:i,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...o})});o.displayName="Input"},85057:(e,t,a)=>{a.d(t,{J:()=>d});var r=a(95155),i=a(12115),n=a(40968),o=a(74466),s=a(59434);let l=(0,o.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(n.b,{ref:t,className:(0,s.cn)(l(),a),...i})});d.displayName=n.b.displayName},85511:(e,t,a)=>{a.d(t,{V:()=>d});var r=a(95155);a(12115);var i=a(965),n=a(73158),o=a(35803),s=a(59434),l=a(30285);function d(e){let{className:t,classNames:a,showOutsideDays:d=!0,...c}=e;return(0,r.jsx)(o.hv,{showOutsideDays:d,className:(0,s.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,s.cn)((0,l.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,s.cn)((0,l.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,r.jsx)(i.A,{className:(0,s.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,r.jsx)(n.A,{className:(0,s.cn)("h-4 w-4",t),...a})}},...c})}d.displayName="Calendar"},87481:(e,t,a)=>{a.d(t,{dj:()=>m});var r=a(12115);let i=0,n=new Map,o=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},s=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?o(a):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],d={toasts:[]};function c(e){d=s(d,e),l.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=r.useState(d);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},93473:(e,t,a)=>{a.d(t,{F:()=>s});var r=a(71603),i=a(23640),n=a(98917),o=a(70154);let s=[{id:"coco-pith",name:"Coco Pith",quantity:0,costPrice:120,sellingPrice:180,icon:r.A},{id:"coir-fiber",name:"Coir Fiber",quantity:0,costPrice:250,sellingPrice:350,icon:i.A},{id:"husk-chips",name:"Husk Chips",quantity:0,costPrice:180,sellingPrice:250,icon:n.A},{id:"coconut",name:"Coconut",quantity:0,costPrice:10,sellingPrice:15,icon:o.A},{id:"copra",name:"Copra",quantity:0,costPrice:30,sellingPrice:45,icon:o.A}]}}]);