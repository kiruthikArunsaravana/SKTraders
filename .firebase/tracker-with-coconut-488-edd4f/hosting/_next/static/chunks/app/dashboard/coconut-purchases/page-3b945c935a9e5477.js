(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{14636:(e,t,a)=>{"use strict";a.d(t,{AM:()=>d,Wv:()=>l,hl:()=>c});var s=a(95155),n=a(12115),r=a(98176),i=a(59434);let d=r.bL,l=r.l9,c=n.forwardRef((e,t)=>{let{className:a,align:n="center",sideOffset:d=4,...l}=e;return(0,s.jsx)(r.ZL,{children:(0,s.jsx)(r.UC,{ref:t,align:n,sideOffset:d,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});c.displayName=r.UC.displayName},26126:(e,t,a)=>{"use strict";a.d(t,{E:()=>d});var s=a(95155);a(12115);var n=a(74466),r=a(59434);let i=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:t,variant:a,...n}=e;return(0,s.jsx)("div",{className:(0,r.cn)(i({variant:a}),t),...n})}},37790:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var s=a(95155),n=a(51920),r=a(34301),i=a(30285),d=a(66695),l=a(85127),c=a(26126),o=a(87481),u=a(12115),m=a(54165),h=a(62523),p=a(85057),x=a(52873),f=a(83013),y=a(14636),j=a(85511),g=a(59434),v=a(4635),b=a(35317),N=a(68856),w=a(59409);let P=["Pending","Paid"];function S(){let{toast:e}=(0,o.dj)(),[t,a]=(0,u.useState)(!1),[S,_]=(0,u.useState)(),[C,q]=(0,u.useState)("all"),A=(0,v.jt)(),F=(0,v.$e)(()=>A?(0,b.P)((0,b.rJ)(A,"coconut_purchases"),(0,b.My)("date","desc")):null,[A]),L=(0,v.$e)(()=>A?(0,b.P)((0,b.rJ)(A,"clients")):null,[A]),{data:E,isLoading:D}=(0,v.Ge)(F),{data:H,isLoading:k}=(0,v.Ge)(L),J=(0,u.useMemo)(()=>E?E.filter(e=>{let t=(()=>{if(!(null==S?void 0:S.from))return!0;let t=S.from,a=new Date(S.to?S.to:t);a.setHours(23,59,59,999);let s=e.date.toDate();return(0,x.v)(s,{start:t,end:a})})(),a="all"===C||e.paymentStatus===C;return t&&a}):[],[E,S,C]);async function V(t){if(t.preventDefault(),!A)return void e({variant:"destructive",title:"Error",description:"Firestore is not available."});let s=new FormData(t.currentTarget),n=s.get("clientId"),r=parseFloat(s.get("quantity")),i=parseFloat(s.get("price")),d=s.get("paymentStatus");if(!n||!r||!i||!d)return void e({variant:"destructive",title:"Validation Error",description:"Please fill out all fields correctly."});let l=null==H?void 0:H.find(e=>e.id===n);if(!l)return void e({variant:"destructive",title:"Error",description:"Selected client not found."});let c=b.Dc.now();try{await (0,b.c4)(A,async e=>{let t,a=(0,b.H9)(A,"products","coconut"),s=await e.get(a);t=s.exists()?(s.data().quantity||0)+r:r;let n=(0,b.H9)((0,b.rJ)(A,"coconut_purchases"));if(e.set(n,{clientId:l.id,clientName:l.companyName,quantity:r,price:i,date:c,paymentStatus:d}),"Paid"===d){let t=r*i;e.set((0,b.H9)((0,b.rJ)(A,"financial_transactions")),{type:"expense",amount:-t,description:"Purchase of ".concat(r," coconuts from ").concat(l.companyName),category:"Coconut",date:c,clientName:l.companyName,quantity:r})}e.set(a,{id:"coconut",name:"Coconut",quantity:t,costPrice:10,sellingPrice:15,modifiedDate:c},{merge:!0})}),a(!1),t.target.reset(),e({title:"Coconut Purchase Added",description:"Purchase from ".concat(l.companyName," recorded, and stock updated.")})}catch(t){console.error("Failed to add coconut purchase:",t),e({variant:"destructive",title:"Operation Failed",description:t.message||"Could not save the purchase and update stock. Please try again."})}}let I=async(t,a)=>{if(!A)return void e({variant:"destructive",title:"Error",description:"Could not update status."});if(a===t.paymentStatus)return;let s=(0,b.H9)(A,"coconut_purchases",t.id);try{if(await (0,b.mZ)(s,{paymentStatus:a}),"Paid"===a){let a=t.quantity*t.price;await (0,b.gS)((0,b.rJ)(A,"financial_transactions"),{type:"expense",amount:-a,description:"Paid for purchase of ".concat(t.quantity," coconuts from ").concat(t.clientName),category:"Coconut",date:b.Dc.now(),clientName:t.clientName,quantity:t.quantity}),e({title:"Payment Status Updated",description:"Purchase marked as paid and an expense has been recorded."})}else e({title:"Payment Status Updated",description:"Purchase status has been updated to ".concat(a,".")})}catch(t){console.error("Failed to update payment status:",t),e({variant:"destructive",title:"Update Failed",description:t.message||"Could not update the payment status. Please try again."})}},G=e=>{switch(e){case"Paid":return"default";case"Pending":return"destructive";default:return"outline"}},O=D||k;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center gap-2 flex-wrap",children:[(0,s.jsx)("h1",{className:"text-3xl font-headline",children:"Coconut Purchases"}),(0,s.jsxs)("div",{className:"flex gap-2 flex-wrap justify-end",children:[(0,s.jsxs)(y.AM,{children:[(0,s.jsx)(y.Wv,{asChild:!0,children:(0,s.jsxs)(i.$,{variant:"outline",className:(0,g.cn)("w-full sm:w-[280px] justify-start text-left font-normal",!S&&"text-muted-foreground"),children:[(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4"}),(null==S?void 0:S.from)?S.to?(0,s.jsxs)(s.Fragment,{children:[(0,f.GP)(S.from,"LLL dd, y")," - ",(0,f.GP)(S.to,"LLL dd, y")]}):(0,f.GP)(S.from,"LLL dd, y"):(0,s.jsx)("span",{children:"Filter by date..."})]})}),(0,s.jsx)(y.hl,{className:"w-auto p-0",align:"end",children:(0,s.jsx)(j.V,{initialFocus:!0,mode:"range",selected:S,onSelect:_,numberOfMonths:2})})]}),(0,s.jsxs)(w.l6,{value:C,onValueChange:e=>q(e),children:[(0,s.jsx)(w.bq,{className:"w-full sm:w-[180px]",children:(0,s.jsx)(w.yv,{placeholder:"Filter by payment..."})}),(0,s.jsxs)(w.gC,{children:[(0,s.jsx)(w.eb,{value:"all",children:"All Payments"}),P.map(e=>(0,s.jsx)(w.eb,{value:e,children:e},e))]})]})]})]}),(0,s.jsxs)(d.Zp,{children:[(0,s.jsxs)(d.aR,{className:"flex-row items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.ZB,{children:"Purchase Records"}),(0,s.jsxs)(d.BT,{children:["Track all your coconut purchases. Showing ",J.length," record(s)."]})]}),(0,s.jsxs)(m.lG,{open:t,onOpenChange:a,children:[(0,s.jsx)(m.zM,{asChild:!0,children:(0,s.jsxs)(i.$,{children:[(0,s.jsx)(r.A,{className:"mr-2 h-5 w-5"})," Add Purchase"]})}),(0,s.jsxs)(m.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(m.c7,{children:[(0,s.jsx)(m.L3,{children:"Add New Coconut Purchase"}),(0,s.jsx)(m.rr,{children:"Enter the details of the new purchase. Stock will be increased. If status is 'Paid', an expense is also created."})]}),(0,s.jsxs)("form",{onSubmit:V,children:[(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(p.J,{htmlFor:"clientId",children:"Client"}),(0,s.jsxs)(w.l6,{name:"clientId",required:!0,children:[(0,s.jsx)(w.bq,{children:(0,s.jsx)(w.yv,{placeholder:"Select a client"})}),(0,s.jsx)(w.gC,{children:k?(0,s.jsx)(w.eb,{value:"loading",disabled:!0,children:"Loading clients..."}):null==H?void 0:H.map(e=>(0,s.jsx)(w.eb,{value:e.id,children:e.companyName},e.id))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(p.J,{htmlFor:"quantity",children:"Quantity (pieces)"}),(0,s.jsx)(h.p,{id:"quantity",name:"quantity",type:"number",placeholder:"e.g., 10000",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(p.J,{htmlFor:"price",children:"Price Per Piece"}),(0,s.jsx)(h.p,{id:"price",name:"price",type:"number",step:"0.01",placeholder:"e.g., 12.50",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(p.J,{htmlFor:"paymentStatus",children:"Payment Status"}),(0,s.jsxs)(w.l6,{name:"paymentStatus",defaultValue:"Pending",required:!0,children:[(0,s.jsx)(w.bq,{children:(0,s.jsx)(w.yv,{placeholder:"Select payment status"})}),(0,s.jsx)(w.gC,{children:P.map(e=>(0,s.jsx)(w.eb,{value:e,children:e},e))})]})]})]}),(0,s.jsx)(m.Es,{children:(0,s.jsx)(i.$,{type:"submit",children:"Add Purchase"})})]})]})]})]}),(0,s.jsx)(d.Wu,{children:(0,s.jsxs)(l.XI,{children:[(0,s.jsx)(l.A0,{children:(0,s.jsxs)(l.Hj,{children:[(0,s.jsx)(l.nd,{children:"Client"}),(0,s.jsx)(l.nd,{className:"hidden sm:table-cell",children:"Quantity"}),(0,s.jsx)(l.nd,{className:"hidden md:table-cell",children:"Date"}),(0,s.jsx)(l.nd,{children:"Payment"}),(0,s.jsx)(l.nd,{className:"text-right",children:"Total Value"})]})}),(0,s.jsxs)(l.BF,{children:[O&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Hj,{children:(0,s.jsx)(l.nA,{colSpan:5,children:(0,s.jsx)(N.E,{className:"h-8 w-full"})})}),(0,s.jsx)(l.Hj,{children:(0,s.jsx)(l.nA,{colSpan:5,children:(0,s.jsx)(N.E,{className:"h-8 w-full"})})})]}),!O&&J.length>0?J.map(e=>(0,s.jsxs)(l.Hj,{children:[(0,s.jsx)(l.nA,{children:(0,s.jsx)("div",{className:"font-medium",children:e.clientName})}),(0,s.jsxs)(l.nA,{className:"hidden sm:table-cell",children:[e.quantity.toLocaleString()," pcs"]}),(0,s.jsx)(l.nA,{className:"hidden md:table-cell",children:(0,f.GP)(e.date.toDate(),"PP")}),(0,s.jsx)(l.nA,{children:"Paid"===e.paymentStatus?(0,s.jsx)(c.E,{variant:G(e.paymentStatus),children:e.paymentStatus}):(0,s.jsxs)(w.l6,{defaultValue:e.paymentStatus,onValueChange:t=>I(e,t),children:[(0,s.jsx)(w.bq,{className:"w-[110px] h-8",children:(0,s.jsx)(w.yv,{placeholder:"Status"})}),(0,s.jsx)(w.gC,{children:P.map(e=>(0,s.jsx)(w.eb,{value:e,children:(0,s.jsx)(c.E,{variant:G(e),className:"w-full text-center",children:e})},e))})]})}),(0,s.jsxs)(l.nA,{className:"text-right",children:["$",(e.quantity*e.price).toLocaleString()]})]},e.id)):!O&&(0,s.jsx)(l.Hj,{children:(0,s.jsx)(l.nA,{colSpan:5,className:"text-center",children:"No purchases match your filters."})})]})]})})]})]})}},77549:(e,t,a)=>{Promise.resolve().then(a.bind(a,37790))},85511:(e,t,a)=>{"use strict";a.d(t,{V:()=>c});var s=a(95155);a(12115);var n=a(965),r=a(73158),i=a(35803),d=a(59434),l=a(30285);function c(e){let{className:t,classNames:a,showOutsideDays:c=!0,...o}=e;return(0,s.jsx)(i.hv,{showOutsideDays:c,className:(0,d.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,d.cn)((0,l.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,d.cn)((0,l.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(n.A,{className:(0,d.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(r.A,{className:(0,d.cn)("h-4 w-4",t),...a})}},...o})}c.displayName="Calendar"}},e=>{var t=t=>e(e.s=t);e.O(0,[992,644,163,33,878,13,152,659,309,760,474,594,441,684,358],()=>t(77549)),_N_E=e.O()}]);